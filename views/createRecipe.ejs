<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Cookmaster - Nova Receita</title>
    <style>
      #hide {
        display: none;
      }
    </style>
  </head>
  <body>
    <h1>Nova Receita</h1>
    <form action="/recipes" method="POST">
      <input type="text" id="hide" name="ingredients" />

      <label for="name">Nome da Receita </label>
      <input data-testid="nome-receita" name="name" type="text" id="name" />

      <label for="input">Adicionar Ingrediente </label>
      <input data-testid="ingredientes" type="text" id="input" />
      <button data-testid="adicionar-ingrediente" type="button" id="ingBtn">
        Adicionar ingrediente
      </button>

      <ul id="list"></ul>

      <label for="instructions">Modo de Preparo </label>
      <input data-testid="modo-de-preparo" type="text" name="instructions" id="instructions" />

      <button data-testid="postar-receita" type="submit">Salvar Receita</button>
    </form>
    <a href="/">Voltar</a>
  </body>
  <script>
    const ingList = []; // cria um array vazio para a lista de ingredientes
    const ingStr = ingList.join(', ');
    document.getElementById('ingBtn').addEventListener('click', addIng);

    function addIng() {
      const hideInput = document.getElementById('hide'); // input com os ingredientes(escondido)
      const input = document.getElementById('input'); // seleciona o input
      const list = document.getElementById('list'); // seleciona a lista

      const li = document.createElement('li'); // cria uma li
      const deleteBtn = document.createElement('button'); // cria um botao (que será de excluir)
      li.innerText = input.value; // atribui o texto da li com o valor passado para o input

      deleteBtn.type = 'button'; // tipo do botão de delete
      deleteBtn.innerText = 'Excluir Ingrediente'; // texto do botão de delete

      // adiciona ao array de ingredientes o valor do input
      ingList.push(input.value);
      // adiciona ao input escondido o valor do array de ingredientes e conecta com o banco
      hideInput.value = ingList.join(', ');

      list.appendChild(li); // adiciona à lista o li criado
      li.appendChild(deleteBtn); // adiciona ao li criado o botão de delete

      deleteBtn.addEventListener('click', (e) => {
        // ao clicar no botao de delete:
        hideInput.value = ingList.join(', ');
        // salva na variavel 'index' a posição do ingrediente no array
        const index = ingList.indexOf(input.value);
        // retira do array o elemento na posição 'index', variavel criada acima
        ingList.slice(index);
        // remove do node o alvo do evento de clique
        e.target.parentNode.remove();
      });
    }
  </script>
</html>
