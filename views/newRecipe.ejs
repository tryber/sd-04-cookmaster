<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nova Receita</title>
</head>

<body>
  <%- include('components/navbar', { user }) %>
  <h1>Nova Receita</h1>
  <form action="/recipes" method="POST">
    <label for="name">Nome da Receita</label>
    <input data-testid="nome-receita" name="name" type="text" />
    <input type="hidden" name="ingredients" id="ingredientesDBField" />
    <input data-testid="ingredientes" id="ingredientsInput" type="text" />
    <ul id="list"></ul>
    <button data-testid="adicionar-ingrediente" id="addButton" type="button">
      Adicionar Ingredientes
    </button>
    <label for="instructions">Modo de preparo</label>
    <input data-testid="modo-de-preparo" name="instructions" type="text" />
    <a href="/">
      <button>Voltar</button>
    </a>
    <button data-testid="postar-receita" type="submit">Salvar Receita</button>
  </form>
  <script>
    const addButton = document.getElementById('addButton');
    let ingredientInput = document.getElementById('ingredientsInput');
    let ingredientesDBField = document.getElementById('ingredientesDBField');
    let list = document.getElementById('list');
    let ingredientsArray = [];

    const addIngredient = () => {
      const li = document.createElement('li');
      li.innerHTML = ingredientInput.value;
      list.appendChild(li);

      ingredientInput.value = '';

      if (!ingredientsArray.includes(li.innerText)) {
        ingredientsArray.push(li.innerText); console.log(ingredientsArray);
      }

      const deleteButton = document.createElement('button');
      deleteButton.innerHTML = 'Exclir Ingrediente';
      deleteButton.className = 'deleteIngredientButton';
      deleteButton.type = 'button'
      list.appendChild(deleteButton);

      ingredientInput.innerText = '';

      const deleteIngredient = () => {
        li.remove();
        deleteButton.remove();
        ingredientsArray.splice( ingredientsArray.indexOf(li.innerText), 1 )
      }
      
      ingredientesDBField.value = ingredientsArray.join(',');

      deleteButton.addEventListener('click', deleteIngredient);
    };

    addButton.addEventListener('click', addIngredient)
  </script>
</body>

</html>