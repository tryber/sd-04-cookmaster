<form action=<%=`/recipes${recipe.id ? `/${recipe.id}` : ''}`%> method='POST'>
  <label for="name">
    Nome da Receita
    <input data-testid="nome-receita" type="text" name="name" value="<%-recipe.name%>" required>
  </label>
  <label for="ingredient">
    Ingredientes
    <ul id="ingredients-list">
      <% if (recipe.ingredients) {%>
      <% recipe.ingredients.split(',').forEach( ing => { %>
      <li class="ingredient-item">
        <%-ing%>
        <button type="button" onClick="delIngredient(event)">Excluir
          Ingrediente</button>
      </li>
      <%});%>
      <%}%>
    </ul>
    <input type="hidden" value="<%-recipe.ingredients%>" name="ingredients" id="ingredients"
      required>
      <input data-testid="ingredientes" id="ingredient-input" type="text">
      <button data-testid="adicionar-ingrediente" type="button"
        onclick="addIngredient(event)">Adicionar Ingrediente</button>
  </label>
  <label for="instructions">
    Modo de preparo
    <input data-testid="modo-de-preparo" type="text" name="instructions" required
      value="<%-recipe.instructions%>">
  </label>
  <button data-testid="postar-receita" type="submit">Salvar Receita</button>
</form>
<script>
  const list = '<%-recipe.ingredients%>' ? '<%-recipe.ingredients%>'.split(',') : [];

  const updateList = () => document.getElementById('ingredients').value = list.join(',');

  const createLi = (text) => {
    const ul = document.getElementById('ingredients-list');
    const li = document.createElement('li');
    const button = document.createElement('button');
    li.innerText = text;
    li.className = 'ingredient-item'
    button.type = 'button';
    button.onclick = (event) => delIngredient(event, ul.children.length);
    button.innerText = 'Excluir Ingrediente';
    li.appendChild(button);
    ul.appendChild(li);
  }

  const delIngredient = ({ target }) => {
    const index = Array.from(document.getElementsByClassName('ingredient-item')).indexOf(target.parentElement)
    list.splice(index, 1);
    target.parentElement.remove();
    updateList();
  };

  const addIngredient = (event) => {
    const input = document.getElementById('ingredient-input').value;
    document.getElementById('ingredient-input').value = '';
    list.push(input);
    createLi(input);
    updateList();
  }
</script>
